{"version":3,"file":"index.js","sources":["../dist-src/types.js","../dist-src/version.js","../dist-src/node/sign.js","../dist-src/utils.js","../dist-src/node/verify.js"],"sourcesContent":["export var Algorithm;\n(function (Algorithm) {\n    Algorithm[\"SHA1\"] = \"sha1\";\n    Algorithm[\"SHA256\"] = \"sha256\";\n})(Algorithm || (Algorithm = {}));\n","export const VERSION = \"3.0.1\";\n","import { createHmac } from \"crypto\";\nimport { Algorithm } from \"../types\";\nimport { VERSION } from \"../version\";\nexport async function sign(options, payload) {\n    const { secret, algorithm } = typeof options === \"object\"\n        ? {\n            secret: options.secret,\n            algorithm: options.algorithm || Algorithm.SHA256,\n        }\n        : { secret: options, algorithm: Algorithm.SHA256 };\n    if (!secret || !payload) {\n        throw new TypeError(\"[@octokit/webhooks-methods] secret & payload required for sign()\");\n    }\n    if (!Object.values(Algorithm).includes(algorithm)) {\n        throw new TypeError(`[@octokit/webhooks] Algorithm ${algorithm} is not supported. Must be  'sha1' or 'sha256'`);\n    }\n    return `${algorithm}=${createHmac(algorithm, secret)\n        .update(payload)\n        .digest(\"hex\")}`;\n}\nsign.VERSION = VERSION;\n","export const getAlgorithm = (signature) => {\n    return signature.startsWith(\"sha256=\") ? \"sha256\" : \"sha1\";\n};\n","import { timingSafeEqual } from \"crypto\";\nimport { Buffer } from \"buffer\";\nimport { sign } from \"./sign\";\nimport { VERSION } from \"../version\";\nimport { getAlgorithm } from \"../utils\";\nexport async function verify(secret, eventPayload, signature) {\n    if (!secret || !eventPayload || !signature) {\n        throw new TypeError(\"[@octokit/webhooks-methods] secret, eventPayload & signature required\");\n    }\n    const signatureBuffer = Buffer.from(signature);\n    const algorithm = getAlgorithm(signature);\n    const verificationBuffer = Buffer.from(await sign({ secret, algorithm }, eventPayload));\n    if (signatureBuffer.length !== verificationBuffer.length) {\n        return false;\n    }\n    // constant time comparison to prevent timing attachs\n    // https://stackoverflow.com/a/31096242/206879\n    // https://en.wikipedia.org/wiki/Timing_attack\n    return timingSafeEqual(signatureBuffer, verificationBuffer);\n}\nverify.VERSION = VERSION;\n"],"names":["Algorithm","VERSION","sign","options","payload","secret","algorithm","SHA256","TypeError","Object","values","includes","createHmac","update","digest","getAlgorithm","signature","startsWith","verify","eventPayload","signatureBuffer","Buffer","from","verificationBuffer","length","timingSafeEqual"],"mappings":";;;;;;;AAAO,IAAIA,SAAJ;;AACP,CAAC,UAAUA,SAAV,EAAqB;EAClBA,SAAS,CAAC,MAAD,CAAT,GAAoB,MAApB;EACAA,SAAS,CAAC,QAAD,CAAT,GAAsB,QAAtB;AACH,CAHD,EAGGA,SAAS,KAAKA,SAAS,GAAG,EAAjB,CAHZ;;ACDO,MAAMC,OAAO,GAAG,mBAAhB;;ACGA,eAAeC,IAAf,CAAoBC,OAApB,EAA6BC,OAA7B,EAAsC;EACzC,MAAM;IAAEC,MAAF;IAAUC;MAAc,OAAOH,OAAP,KAAmB,QAAnB,GACxB;IACEE,MAAM,EAAEF,OAAO,CAACE,MADlB;IAEEC,SAAS,EAAEH,OAAO,CAACG,SAAR,IAAqBN,SAAS,CAACO;GAHpB,GAKxB;IAAEF,MAAM,EAAEF,OAAV;IAAmBG,SAAS,EAAEN,SAAS,CAACO;GAL9C;;EAMA,IAAI,CAACF,MAAD,IAAW,CAACD,OAAhB,EAAyB;IACrB,MAAM,IAAII,SAAJ,CAAc,kEAAd,CAAN;;;EAEJ,IAAI,CAACC,MAAM,CAACC,MAAP,CAAcV,SAAd,EAAyBW,QAAzB,CAAkCL,SAAlC,CAAL,EAAmD;IAC/C,MAAM,IAAIE,SAAJ,CAAe,iCAAgCF,SAAU,gDAAzD,CAAN;;;EAEJ,OAAQ,GAAEA,SAAU,IAAGM,iBAAU,CAACN,SAAD,EAAYD,MAAZ,CAAV,CAClBQ,MADkB,CACXT,OADW,EAElBU,MAFkB,CAEX,KAFW,CAEJ,EAFnB;AAGH;AACDZ,IAAI,CAACD,OAAL,GAAeA,OAAf;;ACpBO,MAAMc,YAAY,GAAIC,SAAD,IAAe;EACvC,OAAOA,SAAS,CAACC,UAAV,CAAqB,SAArB,IAAkC,QAAlC,GAA6C,MAApD;AACH,CAFM;;ACKA,eAAeC,MAAf,CAAsBb,MAAtB,EAA8Bc,YAA9B,EAA4CH,SAA5C,EAAuD;EAC1D,IAAI,CAACX,MAAD,IAAW,CAACc,YAAZ,IAA4B,CAACH,SAAjC,EAA4C;IACxC,MAAM,IAAIR,SAAJ,CAAc,uEAAd,CAAN;;;EAEJ,MAAMY,eAAe,GAAGC,aAAM,CAACC,IAAP,CAAYN,SAAZ,CAAxB;EACA,MAAMV,SAAS,GAAGS,YAAY,CAACC,SAAD,CAA9B;EACA,MAAMO,kBAAkB,GAAGF,aAAM,CAACC,IAAP,CAAY,MAAMpB,IAAI,CAAC;IAAEG,MAAF;IAAUC;GAAX,EAAwBa,YAAxB,CAAtB,CAA3B;;EACA,IAAIC,eAAe,CAACI,MAAhB,KAA2BD,kBAAkB,CAACC,MAAlD,EAA0D;IACtD,OAAO,KAAP;GARsD;;;;;EAa1D,OAAOC,sBAAe,CAACL,eAAD,EAAkBG,kBAAlB,CAAtB;AACH;AACDL,MAAM,CAACjB,OAAP,GAAiBA,OAAjB;;;;;"}